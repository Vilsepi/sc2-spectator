<!DOCTYPE html>
<html>
<head>
<title>sc2-spectator</title>
<style>
    body {
        background: #000;
    }
    .canvas-area {
        background: #111;
        width: 1400px;
        margin: 0 auto 0 auto;
    }
</style>
</head>
<body>

<div class="canvas-area">
<canvas id="mapCanvas" width="1400" height="1050"></canvas>
</div>

<script>
var canvas = document.getElementById("mapCanvas");
var context = canvas.getContext("2d");
var ws = new WebSocket("ws://127.0.0.1:9000/");

const RENDER_MULTIPLIER = 7;

context.font = "16px Verdana";
context.textAlign = "center";


ws.onmessage = function (event) {
    context.clearRect(0, 0, canvas.width, canvas.height);
    var data = JSON.parse(event.data)

    context.fillStyle = '#393633';
    data.map.forEach(function(point) {
        context.fillRect(point.x * RENDER_MULTIPLIER, point.y * RENDER_MULTIPLIER, 6, 6);
    });

    data.own_units.forEach(function(unit) {
        var radius = unit.radius * 10;
        var opacity = unit.health;
        context.fillStyle = `rgba(9, 196, 93, ${opacity})`;
        context.fillRect(unit.pos_x * RENDER_MULTIPLIER, unit.pos_y * RENDER_MULTIPLIER, radius, radius);
        context.fillText(unit.type, unit.pos_x* RENDER_MULTIPLIER, unit.pos_y* RENDER_MULTIPLIER);
    });

    data.enemy_units.forEach(function(unit) {
        if (unit.is_visible) {
            var opacity = unit.health;
            context.fillStyle = `rgba(221, 2, 79, ${opacity})`;
        }
        else {
            context.fillStyle = '#aaa';
        }
        var radius = unit.radius * 10;
        context.fillRect(unit.pos_x * RENDER_MULTIPLIER, unit.pos_y * RENDER_MULTIPLIER, radius, radius);
        context.fillText(unit.type, unit.pos_x* RENDER_MULTIPLIER, unit.pos_y* RENDER_MULTIPLIER);
    });

};

</script>

</body>
</html>
